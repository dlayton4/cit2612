<!doctype html>
<html>
	<head>
		<script>
			var card;

			function load() {
				var DONE = 4;
				var OK = 200;
				var player_count = 2;

				function newDeck() {
					if (localStorage.getItem("newDeck") === null) {
						var xhr = new XMLHttpRequest();
						xhr.open('GET', 'https://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1');
						xhr.send(null);
						xhr.onreadystatechange = function() {
							if (xhr.readyState === DONE) {
								if (xhr.status === OK) {
									localStorage.setItem("newDeck", xhr.responseText);
									// console.log(xhr.responseText);
								}
							}
						}
					}
				}

				function shuffle() {
					var shufflexhr = new XMLHttpRequest();
					var deck = localStorage.getItem("newDeck");
					deck = JSON.parse(deck);
					shufflexhr.open('GET', `https://deckofcardsapi.com/api/deck/${deck.deck_id}/shuffle/`);
					shufflexhr.send(null);
					shufflexhr.onreadystatechange = function() {
						if (shufflexhr.readyState === DONE) {
							if (shufflexhr.status === OK) {
								console.log(JSON.parse(shufflexhr.responseText));
							}
						}
					}
				}

				newDeck();
				shuffle();

				var deck = localStorage.getItem("newDeck");
				deck = JSON.parse(deck);
				var deckID = deck['deck_id'];

				var urlReq = `https://deckofcardsapi.com/api/deck/${deckID}/draw/?count=1`;
				var drawCardxhr = new XMLHttpRequest();
				drawCardxhr.open('GET', urlReq);

				drawCardxhr.send(null);
				drawCardxhr.onreadystatechange = function() {
					if (drawCardxhr.readyState === DONE) {
						if (drawCardxhr.status === OK) {
							card = JSON.parse(drawCardxhr.responseText);
							var img = document.createElement("img");
							img.setAttribute("src", card.cards[0].image);
							img.setAttribute("alt", card.cards[0].value + " of " + card.cards[0].suit);
							document.getElementById("p1").appendChild(img);
						}
					}
				}
			}
		</script>
	</head>
	<body onload="load()">
		<div id="p1">
			
		</div>
	</body>
</html>